
@{
    ViewBag.Title = "Index";
}

<h2>Index</h2>

@*<script type="text/javascript" src="~/App/Common/Services/BaseService.js"></script>*@
<script type="text/javascript" src="~/App/Common/Services/GenreService.js"></script>

<script type="text/javascript" src="~/App/Genre/GenreController.js"></script>



<div ng-app="FredApp" ng-controller="GenreController">

    {{name}}

    <br />

    {{List}}

</div>

@section scripts
{ 
    @*<script type="text/javascript" src="@Url.Content("~/App/Genre/GenreController.js")"></script>*@ 
}


/*

@{
    ViewBag.Title = "Index";
}
<h2>Genre</h2>
@*<script type="text/javascript" src="~/App/Common/Services/BaseService.js"></script>*@
<script type="text/javascript" src="~/App/Common/Services/GenreService.js"></script>
<script type="text/javascript" src="~/App/Genre/GenreController.js"></script>

<div ng-app="FredApp" ng-controller="GenreController as vm">

    <table class="table">
        <thead>
            <tr>
                <th>
                    Name
                </th>
                <th>
                    Description
                </th>
            </tr>
        </thead>
        <tbody>
            <tr ng-repeat="l in List">
                <td>{{l.Name}}</td>
                <td>{{l.Description}}</td>
                <td><button type="button" class="btn btn-primary" data-target="#edit" data-toggle="modal" ng-click="EditarItem(l, false)">Edit</button></td>
            </tr>
        </tbody>
    </table>

    @Html.Partial("Editar")
</div>

@section scripts
{
    @*<script type="text/javascript" src="@Url.Content("~/App/Genre/GenreController.js")"></script>*@
}

//////////////angularModalService ////////////////////




<form name="edicaoForm" novalidate ng-submit="editar()">
    <div class="modal fade" id="edit" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h4 class="modal-title" id="myModalLabel">Edit Genre</h4>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="form-group" ng-class="{'has-error' : edicaoForm.nameGenre.$invalid}">
                            <span class="help-block has-error">
                                <span ng-show="edicaoForm.$error.required">Name is required</span>
                                <span ng-show="edicaoForm.$error.minlength">Min of 3 chars</span>
                            </span>

                            <label for="nameGenre" class="col-sm-2 control-label">Name</label>
                            <div class="col-sm-10">
                                <input type="text" class="form-control" id="nameGenre" name="nameGenre"
                                       placeholder="Name (required)" ng-model="item.Name" ng-required="true"
                                       ng-minlength="3">
                            </div>
                        </div>
                        <div class="form-group" ng-class="{'has-error' : edicaoForm.descGenre.$invalid}">
                            <span class="help-block has-error" ng-show="edicaoForm.descGenre.$invalid">Description is required</span>
                            <label for="descGenre" class="col-sm-2 control-label">Description</label>
                            <div class="col-sm-10">
                                <textarea class="form-control" id="descGenre" name="descGenre" rows="10"
                                          placeholder="Description" ng-model="item.Description" ng-required="true"
                                          ng-minlength="10"></textarea>
                            </div>
                        </div>                        
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" ng-click="save(edicaoForm.$valid, false)">Save changes</button>
                    <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>                    

                    <script type="text/ng-template" id="modal.html">
                        <div class="modal fade">
                            <div class="modal-dialog">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <button type="button" class="close" ng-click="close('Cancel')" data-dismiss="modal" aria-hidden="true">&times;</button>
                                        <h4 class="modal-title">Confirmation</h4>
                                    </div>
                                    <div class="modal-body">
                                        <p>Confirma a {{message}} dos dados?</p>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" ng-click="close('No')" class="btn btn-default" data-dismiss="modal">Não</button>
                                        <button type="button" ng-click="close('Yes')" class="btn btn-primary" data-dismiss="modal">Sim</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </script>


                </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->
</form>

(function () {
    'use strict';

    angular.module('FredApp')
            .controller('GenreController', genreController);

    genreController.$inject = ['$scope', 'ModalService', 'GenreService'];

    function genreController($scope, ModalService, GenreService) {

        var vm = this;        

        $scope.List = [];
        $scope.item = {};
        $scope.message = {};

        LoadData();

        function LoadData() {

            GenreService.GetAll()
                .then(function (response) {
                    $scope.List = response.data;
                }, function (error) {
                    $scope.status = 'Unable to load Genre data: ' + error.message;
                });
        };


        $scope.EditarItem = function (item, isNew) {
            $scope.item = angular.copy(item);
            var result = isNew ? "inclusão" : "alteração";
            $scope.message = result;
        }

        $scope.save = function (isValid) {
            
            if (isValid == false) { alert("Correct the validation errors first"); return; }

            ModalService.showModal({
                templateUrl: 'modal.html',
                controller: "GenreController"
            }).then(function (modal) {
                modal.element.modal();

                modal.close.then(function (result) {                       
                });                    
            });
        };

        $scope.close = function (result) {
            console.log(result);

            //alert(result);
            //close(result, 500);
        };

    }

})();

(function () {

    'use strict';

    angular
        .module("FredApp")
        .factory('GenreService', ['$http', function ($http) {

            var GenreService = {};            

            GenreService.GetAll = function () {
                return $http.get("/api/Genre/GetList");
            };
            

            //GenreService.GetAll = function () {
            //    var defer = $q.defer();
            //    return $http.get("/api/Genre/GetList")
            //        .then(function (response) {
            //            defer.resolve(response.data);
            //        }.bind(this), function (response) {
            //            defer.reject({ error: response.data, status: response.status });
            //        });

            //    return defer.promise;               
            //};    


            GenreService.GetTest = function () {
                return  [{
                    "GenreId": 1, "Name": "Fred",
                    "Description": "Rock and Roll is a form of rock music developed in the 1950s and 1960s. Rock music combines many kinds of music from the United States, such as country music, folk music, church music, work songs, blues and jazz."
                },
                {
                    "GenreId": 2, "Name": "Jazz",
                    "Description": "Jazz is a type of music which was invented in the United States. Jazz music combines African-American music with European music. Some common jazz instruments include the saxophone, trumpet, piano, double bass, and drums."
                },
                {
                    "GenreId": 3, "Name": "Metal",
                    "Description": "Heavy Metal is a loud, aggressive style of Rock music. The bands who play heavy-metal music usually have one or two guitars, a bass guitar and drums. In some bands, electronic keyboards, organs, or other instruments are used. Heavy metal songs are loud and powerful-sounding, and have strong rhythms that are repeated. There are many different types of Heavy Metal, some of which are described below. Heavy metal bands sometimes dress in jeans, leather jackets, and leather boots, and have long hair. Heavy metal bands sometimes behave in a dramatic way when they play their instruments or sing. However, many heavy metal bands do not like to do this."
                },
                {
                    "GenreId": 4, "Name": "Alternative",
                    "Description": "Alternative rock is a type of rock music that became popular in the 1980s and became widely popular in the 1990s. Alternative rock is made up of various subgenres that have come out of the indie music scene since the 1980s, such as grunge, indie rock, Britpop, gothic rock, and indie pop. These genres are sorted by their collective types of punk, which laid the groundwork for alternative music in the 1970s."
                },
                {
                    "GenreId": 5, "Name": "Disco",
                    "Description": "Disco is a style of pop music that was popular in the mid-1970s. Disco music has a strong beat that people can dance to. People usually dance to disco music at bars called disco clubs. The word \"disco\" is also used to refer to the style of dancing that people do to disco music, or to the style of clothes that people wear to go disco dancing. Disco was at its most popular in the United States and Europe in the 1970s and early 1980s. Disco was brought into the mainstream by the hit movie Saturday Night Fever, which was released in 1977. This movie, which starred John Travolta, showed people doing disco dancing. Many radio stations played disco in the late 1970s."
                }];
            };

            return GenreService;

        }]);

})();

*/
